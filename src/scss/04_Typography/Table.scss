/*  Table
 *    ie5 は <p> に続く <table> の前に </p> が必要
--------------------------------------------------------------------------------------*/
table {
    @include media(tablet) {
        & {
            width : 100% - $TABLET_HORIZONTAL_MARGIN * 2;
        }
    }

    @include media(phablet) {
        & {
            width : 100% - $PHABLET_HORIZONTAL_MARGIN * 2;
        }
    }

    @include media(phone) {
        & {
            width : 100% - $PHONE_HORIZONTAL_MARGIN * 2;
        }
    }

    @include media(watch) {
        & {
            width : 100%;
        }
    }
}

    /* Need 'cellspacing="0"' in the markup for MacIE5 */
    table {
        border-width    : 1px 0 0;
        border-collapse : collapse;
        empty-cells     : show;
        border-spacing  : 0;
        @include responsive-horizontal-margin(1, 1em, 1em);
    }

    caption {
        @include responsive-horizontal-margin(1, 1.5em, #{$PARAGRAPH_LINE_HEIGHT_EM - $BASE_LINE_HEIGHT_EM}); // $PARAGRAPH_LINE_HEIGHT_WATCH
    }

    tr {
        @include unbreak-inside;
    }
    thead, caption {
        @include unbreak-after;
    }

    th, td {
        @include unbreak-box-with-long-text; /* table がカラムを割るのを防ぐ */
    }

    th {
        font-weight  : normal;
        text-align   : left;
        padding      : 0.5em;
        border-width : 0 0 1px;    
    }

    td {
        padding : 0.5em 0;
    }

    thead td {
        padding : 0.5em 0.25em;
    }

    thead th, thead td {
        padding      : 0.5em 0.5em 0.5em 0.4em;
        border-width : 0 0 1px 0.1em;
    }

    tbody th {
        border-width : 0 0 1px;
    }
    tbody td {
        border-width : 0 0.5em 1px;
    }

    @if( $CANUSE_LAST_CHILD_PSEUDO_CLASS and $CANUSE_NEGATIVE_PSEUDO_CLASS ){
        tbody:not(:last-child) tr:last-child > * { /* tfoot を持つ場合に最後の行の線を消す */
            border-bottom-width : 0;
        }
    }

    tfoot th {
        border-width : 2px 0 0;
    }
    tfoot td {
        border-width : 2px 0.5em 0;
    }

/*  color
--------------------------------------------------------------------------------------*/
@mixin table-colors( $text, $fill, $casual_text, $casual_fill ){
    table {
        @if( $UA_IE5 or $UA_IE55 ){
            color : $text;
        }
        border-color : $casual_text;
    }

    thead th, thead td {
        background   : $casual_text;
        border-color : $casual_fill mix( $casual_text, $casual_fill, 90% );
        color        : $fill;
    }
    thead {
        :link,
        .aBodyRoot & :visited {
            color : $fill;
            @if( $HOVER_PSEUDO_CLASS_ONLY_LINK or $CANUSE_HOVER_PSEUDO_CLASS ){
                &:hover {
                    color : $fill;
                }
            }
        }
    }

    tbody th {
        background   : $casual_fill;
        border-color : $fill;
    }
    td {
        border-color : $fill $fill $casual_fill;
    }

    tfoot th,
    tfoot td {
        border-color : $casual_text $fill;
    }

    blockquote {
        table {
            border-color : $text;
        }
        thead th, thead td {
            background   : $text;
            border-color : $casual_fill mix( $text, $casual_fill, 90% );
        }
        tbody th {
            background   : $casual_text;
            border-color : $casual_fill;
            color        : $fill;
            :link,
            .aBodyRoot & :visited {
                color : $fill;
                @if( $HOVER_PSEUDO_CLASS_ONLY_LINK or $CANUSE_HOVER_PSEUDO_CLASS ){
                    &:hover {
                        color : $fill;
                    }
                }
            }
        }
        td {
            border-color : $casual_fill $casual_fill $casual_text;
        }
        tfoot th,
        tfoot td {
            border-color : $text $casual_fill;
        }

        @if( $CANUSE_HOVER_PSEUDO_CLASS ){
            tbody :hover td {
                border-color : $casual_fill $casual_fill $COLOR_ACCENT;
            }
        }
    }
}

@include table-colors( $COLOR_Light_text, $COLOR_Light_fill, $COLOR_Light_casual_text, $COLOR_Light_casual_fill );

@if( $CANUSE_HOVER_PSEUDO_CLASS ){
    tbody :hover th {
        background : $COLOR_ACCENT;
        color      : #fff;
        :link, :visited {
            color : #fff;
        }
    }
    tbody :hover td {
        border-color : $COLOR_Light_fill $COLOR_Light_fill $COLOR_ACCENT;
        color        : $COLOR_ACCENT;
    }

    tbody :hover th a {
        @if( $CANT_CHANGE_TEXT_COLOR_WHEN_FOCUS ){
            background : $COLOR_ACCENT !important; // テキスト色が明るいのでアクセント色で塗る
        } @else if( $FOCUSED_COLOR_FIXED_AT_SYSTEM_COLOR == false ){
            @include active-focus-pseudo-class {
                background : #fff !important;
                color      : $COLOR_ACCENT !important;
            }
        }
    }
}

@if( $CANT_CHANGE_TEXT_COLOR_WHEN_FOCUS ){
    thead a:focus,
    blockquote tbody th a:focus {
        background : $COLOR_ACCENT !important; // テキスト色が明るいのでアクセント色で塗る
    }
}

/*  Dark theme
--------------------------------------------------------------------------------------*/
@include media(dark_theme) {
    @include table-colors( $COLOR_Dark_text, $COLOR_Dark_fill, $COLOR_Dark_casual_text, $COLOR_Dark_casual_fill );

    tbody :hover td {
        border-color : $COLOR_Dark_fill $COLOR_Dark_fill $COLOR_ACCENT;
    }
}
/*  Forced colors
--------------------------------------------------------------------------------------*/
@include media(forced_colors_native){
    td, tfoot td {
        border-left-color  : Window;
        border-right-color : Window;
    }
}
@include media(forced_colors_native_or_fallback){
    table {
        border-width    : 2px 0 0;
        border-spacing  : 2px;
        border-collapse : separate;
    }
    thead, th {
        font-weight : bold;
    }
    td {
        padding      : 0.5em 0.25em;
        border-style : dotted;
    }
    thead th, thead td {
        border-width : 0 0 2px;
        padding      : 0.5em;
    }
    tbody td {
        border-width : 0 0 1px;
    }
    @if( $CANUSE_LAST_CHILD_PSEUDO_CLASS == false and $CANUSE_1ST_CHILD_PSEUDO_CLASS ){ // 該当は ie8 だけ
         /* tfoot を持つ場合に最後の行の線を消す */
        tfoot tr:first-child th,
        tfoot tr:first-child td {
            position : relative;
            top      : -3px;
        }
    }
    tfoot td {
        border-width : 2px 0 0;
    }
}

/*  Print
--------------------------------------------------------------------------------------*/
@include media(print) {
    table {
        margin       : 1em 0;
        width        : 100%;
        border-color : $COLOR_Print_casual_text;
    }
    th {
        font-weight : bold;
    }

    thead th, thead td {
        background   : $COLOR_Print_casual_fill;
        border-color : $COLOR_Print_casual_text;
        color        : $COLOR_Print_text;
        padding      : 0.5em;
        border-width : 0 0 1px;
    }    
    tbody th {
        background   : $COLOR_Print_casual_fill;
        border-color : $COLOR_Print_casual_text;
    }
    td {
        border-color : #fff #fff $COLOR_Print_casual_fill;
    }

    tfoot th,
    tfoot td {
        border-color : $COLOR_Print_casual_text #fff;
    }

    thead {
        :link {
            color : $COLOR_Print_link;
        }
        :visited {
            color : $COLOR_Print_visited;
        }
    }

    blockquote {
        table {
            border-color : $COLOR_Print_text;
        }
        thead th, thead td {
            background   : $COLOR_Print_casual_fill;
            border-color : $COLOR_Print_text;
            color        : $COLOR_Print_text;
            padding      : 0.5em;
            border-width : 0 0 1px;
        }
        tbody th {
            background   : $COLOR_Print_casual_fill;
            border-color : $COLOR_Print_text;
            color        : $COLOR_Print_text;
        }
        td {
            border-color : #fff #fff $COLOR_Print_casual_text;
        }

        tfoot th, tfoot td {
            border-color : $COLOR_Print_text #fff;
        }

        thead, tbody {
            th :link {
                color : $COLOR_Print_link;
            }
            th :visited {
                color : $COLOR_Print_visited;
            }
        }
    }
}